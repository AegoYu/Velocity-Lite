<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Velocity Test</title>
    <script type="text/javascript" src="/assets/velocity-lite.0.1.2.js"></script>
    <script type="text/javascript" src="./dist/arttemplate.js"></script>
    <script type="text/javascript" src="./dist/data-test.js"></script>
</head>
<body>
<script>
    //执行次数
    var num = 1000;

    //数据量
    var count = 100;
    //velocity
    var velocityFn = (function () {
        with (arguments[0]) {
            with (arguments[1]) {
                var __ = [];
                __.push('        ');
                var foreach = {};
                foreach.count = 0;
                foreach.index = -1;
                for (var _v0 in result) {
                    foreach.count++;
                    foreach.index++;
                    var i = result[_v0];
                    __.push('        <div>            ');
                    if (i.isTrue) {
                        __.push('            <p>', (function () {
                            try {
                                return (i.p1 ? i.p1 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            <p>', (function () {
                            try {
                                return (i.p2 ? i.p2 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            <p>', (function () {
                            try {
                                return (i.p3 ? i.p3 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            <p>', (function () {
                            try {
                                return (i.p4 ? i.p4 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            <p>', (function () {
                            try {
                                return (i.p5 ? i.p5 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            ');
                    } else {
                        __.push('            <p>', (function () {
                            try {
                                return (i.p1 ? i.p1 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            <p>', (function () {
                            try {
                                return (i.p2 ? i.p2 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            <p>', (function () {
                            try {
                                return (i.p3 ? i.p3 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            <p>', (function () {
                            try {
                                return (i.p4 ? i.p4 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            <p>', (function () {
                            try {
                                return (i.p5 ? i.p5 : '')
                            } catch (e) {
                                return '';
                            }
                        })(), '</p>            ');
                    }
                    __.push('			');
                    var foreach = {};
                    foreach.count = 0;
                    foreach.index = -1;
                    for (var _v1 in i.obj) {
                        foreach.count++;
                        foreach.index++;
                        var item = i.obj[_v1];
                        __.push('			');
                        if (item.success) {
                            __.push('            <div>', (item.info), '</div>            ');
                        } else {
                            __.push('            <div>', (item.error), '</div>            ');
                        }
                        __.push(' ');
                    }
                    __.push('        </div>        ');
                }
                return __.join('');
            }
        }
        ;

    });
    var velocityFnNoWith = (function ($data) {
        var __ = [];
        var result = $data.result;
        __.push('        ');
        var foreach = {};
        foreach.count = 0;
        foreach.index = -1;
        for (var _v0 in result) {
            foreach.count++;
            foreach.index++;
            var i = result[_v0];
            __.push('        <div>            ');
            if (i.isTrue) {
                __.push('            <p>', (function () {
                    try {
                        return (i.p1 ? i.p1 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            <p>', (function () {
                    try {
                        return (i.p2 ? i.p2 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            <p>', (function () {
                    try {
                        return (i.p3 ? i.p3 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            <p>', (function () {
                    try {
                        return (i.p4 ? i.p4 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            <p>', (function () {
                    try {
                        return (i.p5 ? i.p5 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            ');
            } else {
                __.push('            <p>', (function () {
                    try {
                        return (i.p1 ? i.p1 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            <p>', (function () {
                    try {
                        return (i.p2 ? i.p2 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            <p>', (function () {
                    try {
                        return (i.p3 ? i.p3 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            <p>', (function () {
                    try {
                        return (i.p4 ? i.p4 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            <p>', (function () {
                    try {
                        return (i.p5 ? i.p5 : '')
                    } catch (e) {
                        return '';
                    }
                })(), '</p>            ');
            }
            __.push('			');
            var foreach = {};
            foreach.count = 0;
            foreach.index = -1;
            for (var _v1 in i.obj) {
                foreach.count++;
                foreach.index++;
                var item = i.obj[_v1];
                __.push('			');
                if (item.success) {
                    __.push('            <div>', (item.info), '</div>            ');
                } else {
                    __.push('            <div>', (item.error), '</div>            ');
                }
                __.push(' ');
            }
            __.push('        </div>        ');
        }
        return __.join('');
    });
    //artTemplate
    var artFn = (function ($data, $filename) {
        'use strict';
        var $utils = template.utils,
                $helpers = $utils.$helpers,
                $each = $utils.$each,
                result = $data.result,
                r = $data.r,
                $index = $data.$index,
                $escape = $utils.$escape,
                value = $data.value,
                $out = '';
        $out += '\n		##artTemplate\n        ';
        $each(result,
                function (r, $index) {
                    $out += '\n        <div>\n            ';
                    if (r.isTrue) {
                        $out += '\n            <p>';
                        $out += $escape(r.p1);
                        $out += '</p>\n            <p>';
                        $out += $escape(r.p2);
                        $out += '</p>\n            <p>';
                        $out += $escape(r.p3);
                        $out += '</p>\n            <p>';
                        $out += $escape(r.p4);
                        $out += '</p>\n            <p>';
                        $out += $escape(r.p5);
                        $out += '</p>\n            ';
                    } else {
                        $out += '\n            <p>';
                        $out += $escape(r.p1);
                        $out += '</p>\n            <p>';
                        $out += $escape(r.p2);
                        $out += '</p>\n            <p>';
                        $out += $escape(r.p3);
                        $out += '</p>\n            <p>';
                        $out += $escape(r.p4);
                        $out += '</p>\n            <p>';
                        $out += $escape(r.p5);
                        $out += '</p>\n            ';
                    }
                    $out += '\n			';
                    $each(r.obj,
                            function (value, $index) {
                                $out += '\n			';
                                if (value.success) {
                                    $out += '\n            <div>';
                                    $out += $escape(value.info);
                                    $out += '</div>\n            ';
                                } else {
                                    $out += '\n            <div>';
                                    $out += $escape(value.error);
                                    $out += '</div>\n            ';
                                }
                                $out += ' ';
                            });
                    $out += '\n        </div>\n        ';
                });
        $out += '\n    ';
        return new String($out);
    });
    var data = getDateByNum(count);
    var s, t;
    document.write(count + '条数据渲染平均时间:<br>');
    document.write('artTemplate time:');
    s = (new Date()).getTime();
    for (var i = 0; i < num; i++) {
        artFn(data);
    }
    v = (new Date()).getTime();
    document.write((v - s) / num + 'ms<br>');
    document.write('velocity_has_with time:');
    s = (new Date()).getTime();
    for (var i = 0; i < num; i++) {
        velocityFn(data, {});
    }
    v = (new Date()).getTime();
    document.write((v - s) / num + 'ms<br>');
    document.write('velocity_no_with time:');
    s = (new Date()).getTime();
    for (var i = 0; i < num; i++) {
        velocityFnNoWith(data);
    }
    v = (new Date()).getTime();
    document.write((v - s) / num + 'ms');
</script>
</body>
</html>
